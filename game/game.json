{"nodes":{"ff94aed8-bc3f-4c0b-ac6b-d091c0106130":{"behavior_type":"Screen","name":"Screen","values":{"script":{"String":"fn init() {\n  this.tile_size = 41;  // Default tile size\n  this.gold = rgb(200, 200, 150);\n  this.silver = rgb(192, 192, 192);\n  this.tm1 = this.tilemaps.get(\"UIParts1\");\n  this.iconstm = this.tilemaps.get(\"Icons\");\n  this.movement_id = \"\";\n  this.movement_visible = 0;\n  this.font_name = \"Roboto-Medium\";\n  this.context = \"Inventory\";\n  this.board = rect(671, 197, 326, 364);\n  this.items = rect(671, 90, 326, 80);\n  this.item_id = -1;\n  this.item_highlighted = 0;\n\n  this.message.status(\"Welcome to the Eldiron Demo worthy adventurer.\");\n\n  // The action icon rectangles\n\n  let ts = this.tile_size;\n  this.actions = #{\n    \"Attack\"      : rect(168, 505, 32, 32), \n    \"Move\"        : rect(200, 505, 32, 32),  \n    \"Look\"        : rect(232, 505, 32, 32), \n    \"Use\"         : rect(264, 505, 32, 32), \n    \"Talk\"        : rect(296, 505, 32, 32),\n    \"Equip\"       : rect(328, 505, 32, 32),\n    \"Take\"        : rect(360, 505, 32, 32),\n    \"Drop\"        : rect(392, 505, 32, 32),\n\n    \"Weapon\"      : rect(464, 505, 32, 32), \n    \"Gear\"        : rect(496, 505, 32, 32), \n    \"Inventory\"   : rect(528, 505, 32, 32), \n  };\n  this.curr_action = \"Move\";\n}\n\n// Draw the screen\nfn draw() {\n  let ts = this.tile_size;\n  //this.cmd.draw_rect(rect(0, 0, this.width, this.height), rgb(0, 0, 0)); // Black background\n\n  let shape = shape(); let s = 25; let game_width = 640; let game_height = 581; shape.border_size = 2.0;\n  shape.color = rgb(20, 30, 100); shape.border_color = rgb(100, 100, 100);\n  shape.add_rounded_rect(rect(0, 0, 200, s), rect(10, 15, 0, 15));                     // Top Left\n  shape.add_rounded_rect(rect(400, 0, this.width - 400, s), rect(15, 10, 15, 0));      // Top Right\n  shape.add_rounded_rect(rect(0, 0, s, game_height), rect(10, 0, 10, 0));              // Left Vertical\n  shape.add_rounded_rect(rect(game_width, 0, s, game_height), rect(10, 10, 0, 10));    // Middle Vertical\n  shape.add_rounded_rect(rect(0, game_height - s, this.width, s), rect(0, 0, 10, 10));\n  shape.add_rect(rect(game_width, 70, this.width - game_width, 20));\n  shape.add_rect(rect(game_width, 170, this.width - game_width, s));\n  shape.add_rounded_rect(rect(this.width - s, 0, s, game_height), rect(0, 10, 0, 10));\n  this.cmd.draw_shape(shape);\n\n  this.cmd.draw_text(pos(220, 2), \"Eldiron Demo v0.1\", this.font_name, 19.0, rgb(150, 150, 150));\n\n  // Game\n  this.cmd.draw_game(rect(s, s, 615, 533));\n\n  // Movement control\n  let offset = 0; if this.movement_id == \"West\" { offset = 1; };\n  this.cmd.draw_tile_sat(pos(1 * ts, 11 * ts), this.tm1.get_tile(1 + offset, 8), this.silver);\n  offset = 0; if this.movement_id == \"North\" { offset = 1; };\n  this.cmd.draw_tile_sat(pos(2 * ts, 10 * ts), this.tm1.get_tile(7 + offset, 6), this.silver);\n  offset = 0; if this.movement_id == \"East\" { offset = 1; };\n  this.cmd.draw_tile_sat(pos(3 * ts, 11 * ts), this.tm1.get_tile(4 + offset, 8), this.silver);\n  offset = 0; if this.movement_id == \"South\" { offset = 1; };\n  this.cmd.draw_tile_sat(pos(2 * ts, 12 * ts), this.tm1.get_tile(7 + offset, 7), this.silver);\n  this.movement_visible -= 1;\n  if this.movement_visible <= 0 { this.movement_id = \"\"; }\n\n  // Action Icons\n  let tile;\n  if this.curr_action == \"Attack\" { tile = this.iconstm.get_tile(23, 1); } else { tile = this.iconstm.get_tile(22, 1); }\n  this.cmd.draw_tile_sized(this.actions.Attack.pos, tile, 32);\n  if this.curr_action == \"Move\" { tile = this.iconstm.get_tile(3, 4); } else { tile = this.iconstm.get_tile(2, 4); }\n  this.cmd.draw_tile_sized(this.actions.Move.pos, tile, 32);\n  if this.curr_action == \"Look\" { tile = this.iconstm.get_tile(1, 0);} else { tile = this.iconstm.get_tile(0, 0); }\n  this.cmd.draw_tile_sized(this.actions.Look.pos, tile, 32);\n  if this.curr_action == \"Use\" { tile = this.iconstm.get_tile(21, 2);} else { tile = this.iconstm.get_tile(20, 2); }\n  this.cmd.draw_tile_sized(this.actions.Use.pos, tile, 32);\n  if this.curr_action == \"Talk\" { tile = this.iconstm.get_tile(7, 0);} else { tile = this.iconstm.get_tile(6, 0); }\n  this.cmd.draw_tile_sized(this.actions.Talk.pos, tile, 32);\n  if this.curr_action == \"Equip\" { tile = this.iconstm.get_tile(21, 1);} else { tile = this.iconstm.get_tile(20, 1); }\n  this.cmd.draw_tile_sized(this.actions.Equip.pos, tile, 32);\n  if this.curr_action == \"Take\" { tile = this.iconstm.get_tile(13, 2);} else { tile = this.iconstm.get_tile(12, 2); }\n  this.cmd.draw_tile_sized(this.actions.Take.pos, tile, 32);\n  if this.curr_action == \"Drop\" { tile = this.iconstm.get_tile(15, 2);} else { tile = this.iconstm.get_tile(14, 2); }\n  this.cmd.draw_tile_sized(this.actions.Drop.pos, tile, 32);\n  if this.context == \"Weapon\" { tile = this.iconstm.get_tile(23, 1);} else { tile = this.iconstm.get_tile(22, 1); }\n  this.cmd.draw_tile_sized(this.actions.Weapon.pos, tile, 32);\n  if this.context == \"Gear\" { tile = this.iconstm.get_tile(23, 0);} else { tile = this.iconstm.get_tile(22, 0); }\n  this.cmd.draw_tile_sized(this.actions.Gear.pos, tile, 32);\n  if this.context == \"Inventory\" { tile = this.iconstm.get_tile(11, 0);} else { tile = this.iconstm.get_tile(10, 0); }\n  this.cmd.draw_tile_sized(this.actions.Inventory.pos, tile, 32);\n\n  // Player Info\n  this.cmd.draw_text_rect(rect(671, 26, 326, 20), \"\" + this.player.name, this.font_name, 19.0, rgb(150, 150, 150), \"left\");\n  this.cmd.draw_text_rect(rect(671, 26, 326, 20), \"\" + this.player.gold + \"G\", this.font_name, 19.0, rgb(150, 150, 150), \"right\");\n  this.cmd.draw_text_rect(rect(671, 50, 326, 20), \"HP: \" + this.player.HP + \"  STR:\" + this.player.STR, this.font_name, 19.0, rgb(150, 150, 150), \"left\");\n  \n  // Messages\n  this.cmd.draw_messages(this.board, this.font_name, 16.0, this.silver); \n \n  if this.context == \"Inventory\" {\n    let y = 90;\n    let color = rgb(150, 150, 150);\n    for item in 0..this.inventory.len() {\n      if this.item_id == item && this.item_highlight > 0 {\n        color = this.silver;\n        this.item_highlight -= 1;\n      }\n      this.cmd.draw_text(pos(671, y), \"\" + (item + 1) + \". \" + this.inventory.item_name_at(item), this.font_name, 19.0, color);\n      this.cmd.draw_text_rect(rect(671, y, 326, 20), \"\" + this.inventory.item_amount_at(item), this.font_name, 19.0, color, \"right\");\n      y += 20;\n    }\n  }\n\n  // Info Text\n  this.cmd.draw_text(pos(10, this.height - 22), \"FOR MORE INFORMATION PLEASE VISIT ELDIRON.COM\", this.font_name, 14.0, rgb(150, 150, 150));\n}\n\n// Handle the mouse events\nfn touch_down(x, y) {\n  let tx = x / this.tile_size; let ty = y / this.tile_size;\n\n  let dir = \"\";\n  if tx == 1 && ty == 11 {\n    dir = \"West\"\n  } else\n  if tx == 2 && ty == 10 {\n    dir = \"North\";\n  } else\n  if tx == 3 && ty == 11 {\n    dir = \"East\";\n  } else\n  if tx == 2 && ty == 12 {\n    dir = \"South\";\n  }\n\n  this.handle_action(dir);\n\n  for item in this.actions.keys() {\n    if this.actions[item].is_inside(pos(x, y) ) {\n      if item == \"Messages\" || item == \"Gear\" || item == \"Inventory\" || item == \"Weapon\" {\n        this.context = item;\n      } else {\n        this.curr_action = item;\n      }\n    } \n  }\n\n  // Item based action ?\n  if this.items.is_inside(pos(x, y)) {\n    let item = (y - this.items.y) / 20;\n    if this.inventory.len() > item {\n      this.cmd.action_inventory(this.curr_action, item);\n      this.item_id = 0;\n      this.item_highlight = 2;\n      this.curr_action = \"Move\";\n    }\n  }\n}\n\n// Handle key down events\nfn key_down(key) {\n  let dir = \"\";\n  if key == \"left\" {\n    dir = \"West\";\n  } else\n  if key == \"right\" {\n    dir = \"East\";\n  } else\n  if key == \"up\" {\n    dir = \"North\";\n  } else\n  if key == \"down\" {\n    dir = \"South\";\n  } else \n  if key == \"a\" {\n    this.curr_action = \"Attack\";\n  } else\n  if key == \"l\" {\n    this.curr_action = \"Look\";\n  } else\n  if key == \"k\" {\n    this.curr_action = \"Talk\";\n  } else\n  if key == \"m\" {\n    this.curr_action = \"Move\";\n  } else\n  if key == \"u\" {\n    this.curr_action = \"Use\";\n  } else\n  if key == \"t\" {\n    this.curr_action = \"Take\";\n  } else\n  if key == \"d\" {\n    this.curr_action = \"Drop\";\n  } else\n  if key == \"k\" {\n    this.curr_action = \"Talk\";\n  } else\n  if key == \"i\" {\n    this.context = \"Inventory\";\n  } else\n  if key == \"o\" {\n    this.context = \"Messages\";\n  } else\n  if key == \"g\" {\n    this.context = \"Gear\";\n  } else\n  if key == \"w\" {\n    this.context = \"Weapon\";\n  }\n\n  // Inventory Action ?\n  if this.context == \"Inventory\" {\n    if key == \"1\" {\n      if this.inventory.len() > 0 {\n        this.cmd.action_inventory(this.curr_action, 0);\n        this.item_id = 0;\n        this.item_highlight = 2;\n        this.curr_action = \"Move\";\n      }\n    }\n  }\n\n  this.handle_action(dir);\n}\n\n// Execute action for the given direction\nfn handle_action(dir) {\n  if dir.len() > 0 {\n    this.movement_id = dir;\n    this.movement_visible = 2;\n    this.cmd.action(this.curr_action, dir);\n    this.curr_action = \"Move\";\n  }\n}"}},"id":"ff94aed8-bc3f-4c0b-ac6b-d091c0106130","position":[339,239]},"2b962655-d12d-4f18-9dfc-f380219a3921":{"behavior_type":"BehaviorTree","name":"Game","values":{"execute":{"Integer":0}},"id":"2b962655-d12d-4f18-9dfc-f380219a3921","position":[373,58]},"affd5d73-d981-4792-9a10-7ade9485d214":{"behavior_type":"BehaviorType","name":"Behavior Type","values":{"startup":{"String":"Game"}},"id":"affd5d73-d981-4792-9a10-7ade9485d214","position":[0,0]}},"connections":[["2b962655-d12d-4f18-9dfc-f380219a3921","Bottom","ff94aed8-bc3f-4c0b-ac6b-d091c0106130","Top"]],"id":"ad56f52c-4c6b-4bfb-85db-dca8d12292d7","name":"game","curr_node_id":"ff94aed8-bc3f-4c0b-ac6b-d091c0106130","instances":[],"loot":null,"settings":{"properties":[{"name":"screen_size","value":{"IntX":[1024,608]}},{"name":"square_tile_size","value":{"Int":32}},{"name":"primary_currency","value":{"String":"gold"}},{"name":"secondary_currency","value":{"String":"silver"}},{"name":"secondary_to_primary","value":{"Int":100}},{"name":"hitpoints","value":{"String":"HP"}}],"error":null}}